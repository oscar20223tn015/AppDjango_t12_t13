<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Usuario</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
   
</head>
<body>
    <div class="container">
        <h2 class="my-4">Formulario de Registro</h2>
        <form method="post" onsubmit="return validateForm()">
            {% csrf_token %}

            <div class="mb-3">
                <label for="email" class="form-label">Correo electrónico:</label>
                <input type="email" id="email" name="email" class="form-control" value="{{ form.email.value|default_if_none:'' }}" required title="Introduce un correo electrónico válido." onblur="validateEmail()">
            </div>

            <div class="mb-3">
                <label for="name" class="form-label">Nombre:</label>
                <input type="text" id="name" name="name" class="form-control" value="{{ form.name.value|default_if_none:'' }}" required minlength="2" maxlength="100">
            </div>

            <div class="mb-3">
                <label for="surname" class="form-label">Apellido:</label>
                <input type="text" id="surname" name="surname" class="form-control" value="{{ form.surname.value|default_if_none:'' }}" required minlength="2" maxlength="100">
            </div>

            <div class="mb-3">
                <label for="control_number" class="form-label">Matrícula:</label>
                <input type="text" id="control_number" name="control_number" class="form-control" value="{{ form.control_number.value|default_if_none:'' }}" required onblur="validateMatricula()">
            </div>

            <div class="mb-3">
                <label for="tel" class="form-label">Teléfono:</label>
                <input type="tel" id="tel" name="tel" class="form-control" value="{{ form.tel.value }}" required onblur="validatePhone()">
            </div>

            <div class="mb-3">
                <label for="password1" class="form-label">Contraseña:</label>
                <input type="password" id="password1" name="password1" class="form-control" required minlength="8" maxlength="20" onblur="validatePassword()">
            </div>

            <div class="mb-3">
                <label for="password2" class="form-label">Confirmar Contraseña:</label>
                <input type="password" id="password2" name="password2" class="form-control" required minlength="8" maxlength="20">
            </div>

            <button type="submit" class="btn btn-primary">Registrarse</button>
        </form>
    </div>

    <!-- Modal de error -->
    <div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="errorModalLabel">Error de Validación</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p id="error-message"></p> <!-- El mensaje de error será mostrado aquí -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
    <script>
       function validatePassword() {
    var password1 = document.getElementById('password1').value;
    var password2 = document.getElementById('password2').value;

    // Validación de la contraseña
    var regex = /^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
    if (!regex.test(password1)) {
        showError("La contraseña debe tener al menos 8 caracteres, 1 mayúscula, 1 número y 1 carácter especial.");
        return false;
    }

    // Validación de que las contraseñas coinciden
    if (password1 !== password2) {
        showError("Las contraseñas no coinciden.");
        return false;
    }

    return true;
}
        // Validación de correo de UTEZ
        function validateEmail() {
            var email = document.getElementById('email').value;
            var regex = /^[a-zA-Z0-9._%+-]+@utez\.edu\.mx$/;
            if (!regex.test(email)) {
                showError("El correo debe ser de la UTEZ (ejemplo: usuario@utez.edu.mx).");
                return false;
            }
            return true;
        }
        function validateMatricula() {
             var matricula = document.getElementById('control_number').value;
             var regex = /^[0-9]{4}3tn[0-9]{3}$/;
            if (!regex.test(matricula)) {
                showError("Error en la Matrícula: La matrícula debe ser de la utez (Ejemplo: 20223tn015).");
                return false;
    }
    return true;
}

        // Validación de teléfono
        function validatePhone() {
            var phone = document.getElementById('tel').value;
            var regex = /^[0-9]{10}$/;
            if (!regex.test(phone)) {
                showError("El número de teléfono debe tener exactamente 10 dígitos.");
                return false;
            }
            return true;
        }

        // Mostrar el modal de error
        function showError(message) {
            document.getElementById('error-message').textContent = message;
            var myModal = new bootstrap.Modal(document.getElementById('errorModal'));
            myModal.show();
        }

        // Ejecutar todas las validaciones
        function validateForm() {
            if (validatePassword()  && validateEmail() && validateMatricula() && validatePhone()) {
                return true;
            }
            return false;
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
